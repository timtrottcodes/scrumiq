<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ScrumIQ - Scrum Board</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 20px; }
    .board { display: flex; gap: 15px; overflow-x: auto; }
    .column { flex: 0 0 250px; background: #f8f9fa; padding: 10px; border-radius: 5px; }
    .column h5 { text-align: center; margin-bottom: 10px; }
    .card { margin-bottom: 10px; cursor: grab; }
    .backlog-list { max-height: 200px; overflow-y: auto; }
    .close-btn { float: right; cursor: pointer; font-weight: bold; }
  </style>
</head>
<body>

<div class="container">
  <h2 class="mb-4">ScrumIQ</h2>
  
  <!-- Project Selector -->
  <div class="mb-3">
    <label for="projectSelect" class="form-label">Select Project:</label>
    <select id="projectSelect" class="form-select"></select>
    <button class="btn btn-primary mt-2" id="addProjectBtn">Add Project</button>
  </div>

  <!-- Add Story/Bug -->
  <div class="mb-3">
    <input type="text" id="storyTitle" class="form-control mb-2" placeholder="Story / Bug title">
    <select id="storyType" class="form-select mb-2">
      <option value="Story">Story</option>
      <option value="Bug">Bug</option>
    </select>
    <button class="btn btn-success" id="addStoryBtn">Add to Backlog</button>
  </div>

  <!-- Scrum Board -->
  <div class="board">
    <div class="column" data-stage="backlog">
      <h5>Backlog</h5>
      <div class="backlog-list list-group"></div>
    </div>
    <div class="column" data-stage="todo">
      <h5>To Do</h5>
      <div class="list-group droppable"></div>
    </div>
    <div class="column" data-stage="inprogress">
      <h5>In Progress</h5>
      <div class="list-group droppable"></div>
    </div>
    <div class="column" data-stage="qa">
      <h5>QA</h5>
      <div class="list-group droppable"></div>
    </div>
    <div class="column" data-stage="done">
      <h5>Done</h5>
      <div class="list-group droppable"></div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
$(document).ready(function() {
  const stages = ['backlog', 'todo', 'inprogress', 'qa', 'done'];
  let projects = JSON.parse(localStorage.getItem('projects') || '[]');
  let tasks = JSON.parse(localStorage.getItem('tasks') || '[]');

  function saveData() {
    localStorage.setItem('projects', JSON.stringify(projects));
    localStorage.setItem('tasks', JSON.stringify(tasks));
  }

  function renderProjects() {
    $('#projectSelect').empty();
    projects.forEach((p, idx) => {
      $('#projectSelect').append(`<option value="${idx}">${p.name}</option>`);
    });
  }

  function renderTasks() {
    $('.list-group').empty();
    stages.forEach(stage => {
      let filteredTasks = tasks.filter(t => t.stage === stage && !t.closed);
      filteredTasks.forEach(t => {
        const project = projects[t.project] || {color:'#6c757d'};
        const card = $(`
          <div class="card list-group-item" style="background-color:${project.color}" data-id="${t.id}" draggable="true">
            ${t.title} (${t.type})
            ${stage==='done'?'<span class="close-btn">&times;</span>':''}
          </div>
        `);
        if(stage==='backlog') {
          $(`.column[data-stage="${stage}"] .backlog-list`).append(card);
        } else {
          $(`.column[data-stage="${stage}"] .list-group`).append(card);
        }
      });
    });
  }

  function addTask(title, type, projectIdx) {
    tasks.push({
      id: Date.now(),
      title,
      type,
      project: projectIdx,
      stage: 'backlog',
      closed: false
    });
    saveData();
    renderTasks();
  }

  function addProject(name, color) {
    projects.push({name, color});
    saveData();
    renderProjects();
  }

  // Initial render
  renderProjects();
  renderTasks();

  // Add project
  $('#addProjectBtn').click(() => {
    const name = prompt("Project Name:");
    const color = prompt("Project Color (hex code or bootstrap color):", "#"+Math.floor(Math.random()*16777215).toString(16));
    if(name) addProject(name, color);
  });

  // Add story/bug
  $('#addStoryBtn').click(() => {
    const title = $('#storyTitle').val().trim();
    const type = $('#storyType').val();
    const projectIdx = $('#projectSelect').val();
    if(title && projectIdx !== null) {
      addTask(title, type, projectIdx);
      $('#storyTitle').val('');
    }
  });

  // Drag & Drop
  $(document).on('dragstart', '.card', function(e) {
    e.originalEvent.dataTransfer.setData('id', $(this).data('id'));
  });

  $('.droppable, .backlog-list').on('dragover', function(e) {
    e.preventDefault();
  });

  $('.droppable, .backlog-list').on('drop', function(e) {
    e.preventDefault();
    const id = e.originalEvent.dataTransfer.getData('id');
    const stage = $(this).closest('.column').data('stage');
    const task = tasks.find(t => t.id == id);
    if(task) {
      task.stage = stage;
      saveData();
      renderTasks();
    }
  });

  // Close completed tasks
  $(document).on('click', '.close-btn', function() {
    const id = $(this).closest('.card').data('id');
    const task = tasks.find(t => t.id == id);
    if(task) {
      task.closed = true;
      saveData();
      renderTasks();
    }
  });
});
</script>

</body>
</html>
